{% extends "base.html" %} {% block title %}Test Save Programs — {{ SCHOOL_NAME }}{% endblock %} {% block content %}
<div style="min-height: 100vh; padding: 4rem 2rem; background: linear-gradient(135deg, var(--space-deep), var(--space-navy));">
    <div style="max-width: 800px; margin: 0 auto; background: var(--card-glass); border-radius: 16px; padding: 2.5rem; border: 1px solid var(--card-border);">
        <h1 style="font-size: 2rem; color: var(--text-off-white); margin-bottom: 1rem;">Test: Save Programs</h1>
        <p style="color: rgba(255, 255, 255, 0.7); margin-bottom: 2rem;">Click the bookmark buttons below to save programs to your dashboard</p>

        {% if session.get('user_id') %}
        <div style="display: grid; gap: 1rem;">
            {% for program in programs[:5] %}
            <div style="padding: 1.5rem; background: rgba(255, 255, 255, 0.05); border: 1px solid rgba(255, 255, 255, 0.1); border-radius: 12px; display: flex; justify-content: space-between; align-items: center;">
                <div>
                    <h3 style="color: var(--text-off-white); margin-bottom: 0.5rem;">{{ program.name }}</h3>
                    <p style="color: rgba(255, 255, 255, 0.6); font-size: 0.9rem; margin: 0;">{{ program.organization }}</p>
                </div>
                <button class="save-btn" data-program-id="{{ program.id }}" style="padding: 0.75rem 1.5rem; background: linear-gradient(135deg, var(--cyan-electric), var(--cyan-bright)); color: var(--space-deep); border: none; border-radius: 8px; font-weight: 600; cursor: pointer; transition: all 0.3s;">
                    Save
                </button>
            </div>
            {% endfor %}
        </div>

        <div style="margin-top: 2rem; text-align: center;">
            <a href="{{ url_for('dashboard') }}" style="display: inline-block; padding: 1rem 2rem; background: rgba(0, 229, 255, 0.15); border: 1px solid rgba(0, 229, 255, 0.3); border-radius: 8px; color: var(--cyan-electric); text-decoration: none; font-weight: 600; transition: all 0.3s;">
                Go to Dashboard
            </a>
        </div>
        {% else %}
        <p style="color: rgba(255, 255, 255, 0.7);">
            Please <a href="{{ url_for('login') }}" style="color: var(--cyan-electric);">log in</a> to save programs.
        </p>
        {% endif %}
    </div>
</div>

<script>
    document.querySelectorAll('.save-btn').forEach(btn => {
        btn.addEventListener('click', async function() {
            const programId = this.dataset.programId;
            const button = this;

            try {
                const response = await fetch(`/api/save-program/${programId}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    }
                });

                const data = await response.json();

                if (data.success) {
                    if (data.action === 'saved') {
                        button.textContent = '✓ Saved';
                        button.style.background = 'rgba(76, 175, 80, 0.3)';
                        button.disabled = true;
                    } else {
                        button.textContent = 'Save';
                        button.style.background = 'linear-gradient(135deg, var(--cyan-electric), var(--cyan-bright))';
                        button.disabled = false;
                    }
                }
            } catch (error) {
                console.error('Error:', error);
                alert('Failed to save program');
            }
        });
    });
</script>
{% endblock %}